<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Divvy Bike Race</title>
	    <!-- CSS -->
	    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	    <link rel="stylesheet" href="http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css">
	    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
	    <link rel="stylesheet" href="Assets/CSS/styles.css">
	    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
	    <!-- Scripts -->
	    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	    <script src="http://d3js.org/d3.v3.min.js"></script>
	    <script type="leaflet-tilelayer-geojson-master/TileLayer.GeoJSON.js"></script>
	    <script src="http://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster-src.js"></script>
	    <script src="community_areas.geojson"></script>
	    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
	    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
	    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	</head>

	<style>
	.chart rect {
		fill: blue;
	}

	.chart text {
		fill: white;
		font: 10px sans-serif;
		text-anchor: middle;
	}
	.bar {
	  fill: blue;
	}

	.bar:hover {
	  fill: orange;
	}

	.axis {
	  font: 10px sans-serif;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}

	.x.axis path {
	  display: none;
	}
	</style>

	<body>
		<header>
			<!-- Nav Bar -->
			<nav class="navbar navbar-default">
				<div class="container-fluid">
					<!-- Name -->
					<div class="navbar-header">
						<a class="navbar-brand" href="index.html">CS 424 - Project 2</a>
					</div>
					<!-- Navbar Contents -->
					<div>
						<ul class="nav navbar-nav">
							<li><a href="index.html">Home</a></li>
					        <li class="active"><a href="application.html">Application</a></li>
					        <li><a href="how_to.html">How-To</a></li>
					        <li><a href="data.html">Data</a></li>
					        <li><a href="source_code.html">Source Code</a></li>
					       	<li><a href="interesting_things.html">Interesting Things</a></li> 
					        <li><a href="team_roles.html">Team Roles</a></li> 
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<!-- Main Body -->
		<div class="container-fluid app-main">
			<!-- Main Row -->
			<div class="row app-row">
				<!-- Left Side -->
				<div class="col-sm-6 col-md-6 col-lg-6 app-map">
					<h1 style="text-align: center;">Chicago Map</h1>

					<div id="map"><!--div to hold map-->
						<script>
							//necessary to avoid scoping issues with community areas layer
							var geojson;

							//defines how community areas look when left alone
							function style(feature) {
								return {
								fillColor: '#08519c',
								weight: 3,//outline thickness
								opacity: 1,//outline opacity
								color: '#6baed6',//outline color
								dashArray: '3',//dashed outline value
								fillOpacity: 0.2
								};
							}//end function style(feature)

							//function to highlight a community area on mouseover, similar fields to above function
							function highlightFeature(e) {
								var layer = e.target;

								layer.setStyle({
									weight: 4,
									color: '#08306b',
									dashArray: '',
									fillOpacity: 0.5
								});
								//resolves issues with IE and Opera
								if(!L.Browser.ie && !L.Browser.opera) {
									layer.bringToFront();
								}
								//update info panel with name of community area on mouseover
								info.update(layer.feature.properties);
							}//end highlight community area on mouseover function

							//function to reset highlighting of community area on mouseout
							function resetHighlight(e) {
								geojson.resetStyle(e.target);
								info.update();
							}

							//zoom to community area on click
							function zoomToFeature(e) {
								map.fitBounds(e.target.getBounds());
							}

							//do all "this stuff" for each community area
							function onEachFeature(feature, layer) {
								layer.on({
									mouseover: highlightFeature,
									mouseout: resetHighlight,
									click: zoomToFeature
								});
							}//end function onEachFeature

							//actually load in the community areas geojson file
							geojson = L.geoJson(community_areas, {
								style: style,
								onEachFeature:onEachFeature
							});

							//options for info panel control
							var infoControlOptions = {
								position: 'topleft'
							}

							//control that shows community area info on hover
							var info = L.control(infoControlOptions);

							//creates info control
							info.onAdd = function(map) {
								this._div = L.DomUtil.create('div', 'info');
								this.update();
								return this._div;
							};

							info.update = function(props) {
								this._div.innerHTML = '<h4>Community Area:</h4>' + (props ?
								'<b>' + props.name + '</b><br />'
								: 'Hover over a community area.');
							};

							//mapbox street tiles with proper attribution and max zoom level.
							//max zoom set to 18 because it's the greatest zoom level where everything shows
							var street_map = L.tileLayer('http://{s}.tiles.mapbox.com/v3/nizobe.jn4og4o6/{z}/{x}/{y}.png', {
								attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
								maxZoom: 18
							});//.addTo(map);

							//satellite imagery tile layer
							var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
								attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
							});//end satellite imagery tile layer

							//street and road labels overlay
							var Hydda_RoadsAndLabels = L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png', {
								minZoom: 0,
								maxZoom: 18,
								attribution: 'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
							});//end street and road labels overlay

							//leaflet layerGroup to hold divvy station markers
							var stations = L.layerGroup();

							//markercluster to hold divvy stations
							var markers = new L.MarkerClusterGroup({
								spiderfyOnMaxZoom: true,
								showCoverageOnHover: true,
								zoomToBoundsOnClick: true,
							});

							//loop through .csv and add divvy stations to the statiosn layerGroup
							d3.csv("Divvy_Bicycle_Stations.csv", function(station_list) {
								for(var i = 0; i < station_list.length; i++)
								{
									var station_name = station_list[i].StationName;
									var station_lat = station_list[i].Latitude;
									var station_lon = station_list[i].Longitude;

									//add to the layerGroup
									//marker = new L.marker([station_lat, station_lon]).bindPopup(station_name).openPopup().addTo()
									stations.addLayer(L.marker([station_lat, station_lon]).bindPopup(station_name).openPopup());

									//add to the markerClusterGroup
									markers.addLayer(L.marker([station_lat, station_lon]).bindPopup(station_name).openPopup());
								}//end for loop through .csv file of divvy station locations
							});//end D3 import of divvy station .csv file

							//make a map with anchor lat,lon and zoom level
							var map = L.map('map', {
								center: [41.86968865729827, -87.64699459075926],
								zoom: 11,
								layers: [street_map, Esri_WorldImagery]
							});//.setView([41.86968865729827, -87.64699459075926], 13);

							/*mutually exclusive base map layers
							it seems that the last layer in the list is the default layer
							caveat: satellite (second option on control widget) is checked by default,
							even though the street maps layer is displaed by default */
							var baseMaps = {
								//"Street Map": street_map,
								"Satellite": Esri_WorldImagery,
								"Street Map": street_map
							};

							//toggle-able overlays. visible name : variable name
							var overlayMaps = {
								"Divvy Stations": stations,
								"Streets (for use with satellite map)": Hydda_RoadsAndLabels,
								"Community Areas": geojson
								//"MARKER CLUSTER": markers
								//"CA Info": info
								//"Community Areas": communitiesLayer
								//"Community Areas": community_areas
							};

							//option(s) for layer control widget
							var layerControlOptions = {
								position: 'topleft'
							}

							//adds layer toggle control to the map in top right
							L.control.layers(baseMaps, overlayMaps, layerControlOptions).addTo(map);

							//adds a scale meter to map; defaults to bottom left
							L.control.scale().addTo(map);

							//adds info panel with name of community area to map
							info.addTo(map);
						</script>
					</div><!-- End map -->
				</div> <!-- End Left Side -->

				<!-- Right Side -->
				<div class="col-sm-6 col-md-6 col-lg-6">
					<h1 style="text-align: center;">Data</h1>

					<!-- Master Toggle Button -->
					<div class="row button-master-row">
						<div class+"col-sm-12 col-md-12 col-lg-12">
							<button type="button" id="b0" class="btn btn-default">Show/Hide All</button>
						</div>
					</div><!--End Master Toggle -->


					<!-- Toggle Buttons -->
					<div class="row button-row">
						<div class+"col-sm-12 col-md-12 col-lg-12">
							<button type="button" id="b1" class="btn btn-default">Number of Bikes out per Weekday</button>
         					<button type="button" id="b2" class="btn btn-default">Gender Distribution</button>
          					<button type="button" id="b3" class="btn btn-default">Trips per Day</button>
						</div>
					</div><!--End Toggle Buttons -->

					<!-- Bikes out per weekday -->
					<div class="row data-row">
						<div id='data1' class="col-sm-12 col-md-12 col-lg-12 data-cell">
								<h4 style="text-align: center;">Number Bikes Out Per Weekday</h4>
								<!--SCRIPT TO GENERATE GRAPHS-->
								<script>
								    var width = 960,
								        height = 500,
								        radius = Math.min(width, height) / 2;

								    var color = d3.scale.category20();

								    var arc = d3.svg.arc()
								        .outerRadius(radius - 20)
								        .innerRadius(radius - 100);

								    var pie = d3.layout.pie()
								        .sort(null)
								        .value(function(d) { return d.Count; });

								    var svg = d3.select("#data1").append("svg")
								      	.attr("viewBox", "0 0 960 500")
								      	.attr("preserveAspectRatio", "xMidYMid meet")
								        .append("g")
								        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

								    d3.csv("Assets/CSV/num_day_week.csv", function(error, data) {
								        data.forEach(function(d) {
								        	d.Count = +d.Count;
								     	});

								        var g = svg.selectAll(".arc")
								        	.data(pie(data))
								        	.enter().append("g")
								        	.attr("class", "arc");

								        g.append("path")
								        	.attr("d", arc)
								        	.style("fill", function(d) { return color(d.data.Weekday); });

								        g.append("text")
								        	.style("font-size", 30)
								            .attr("transform", function(d) { 
								            	var center = arc.centroid(d)
								            	x = center[0]
								            	y = center[1]
								            	return "translate(" + x + "," + y + ")"; })
								            .attr("dy", ".35em")
								            .style("text-anchor", "middle")
								            .text(function(d) { return d.data.Weekday; });

										g.append("text")
								        	.style("font-size", 30)
								            .attr("transform", function(d) { 
								            	var center = arc.centroid(d)
								            	x = center[0]
								            	y = center[1]
								            	return "translate(" + x + "," + (y+45) + ")"; })
								            .attr("dy", ".35em")
								            .style("text-anchor", "middle")
								            .text(function(d) { return d.data.Percent; });
								    });

            						$( "#b1" ).click(function() {
              							$( "#data1" ).toggle( "blind", 1000 );
            						});
							    </script>
						</div><!-- End data1 -->
					</div><!-- End data-row --><!-- End Bikes out per weekday -->

					<!-- Gender -->
					<div class="row data-row">
						<div id='data2' class="col-sm-12 col-md-12 col-lg-12 data-cell">
							<h4 style="text-align: center;">Gender</h4>
							<!--SCRIPT TO GENERATE GRAPHS-->
							<script>
								/*this stuff is actually generic and can be re-used from above but i'm leaving it
								in, just in case*/
								var width = 960,
						         	height1 = 500,
						         	radius1 = Math.min(width, height1) / 2;

						      	var color1 = d3.scale.category20();

						     	var arc1 = d3.svg.arc()
						         	.outerRadius(radius1 - 20)
						         	.innerRadius(radius1 - 100);

								var pie = d3.layout.pie()
									.sort(null)
									.value(function(d) { return d.Count; });

								var genderGraph = d3.select('#data2').append("svg")
									.attr("viewBox", "0 0 960 500")
									.attr("preserveAspectRatio", "xMidYMid meet")
									.append("g")
									.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

								d3.csv("Assets/CSV/demo.csv", function(error, data) {
									data.forEach(function(d){
										d.Count = +d.Count;
									});

								var g = genderGraph.selectAll(".arc")
									.data(pie(data))
									.enter().append("g")
									.attr("class", "arc")

								g.append("path")
									.attr("d", arc)
									.style("fill", function(d) { return color(d.data.Gender); });

								g.append("text")
									.style("font-size", 30)
									.attr("transform", function(d) { 
										var center = arc.centroid(d)
										return "translate(" + center + ")"; })
									.attr("dy", ".35em")
									.style("text-anchor", "middle")
									.text(function(d) { return d.data.Gender; });

								g.append("text")
									.style("font-size", 30)
									.attr("transform", function(d) { 
										var center = arc.centroid(d)
										x = center[0]
										y = center[1]
										return "translate(" + (x) + "," + (y+45) + ")"; })
									.attr("dy", ".35em")
									.style("text-anchor", "middle")
									.text(function(d) { return d.data.Percent; });
								});

							</script>

							<!-- Toggle Script -->
							<script>	
								$( "#b2" ).click(function() {
              						$( "#data2" ).toggle( "blind", 1000 );
            					});
						    </script>
						</div><!-- End data2 -->
					</div><!-- End data-row --><!-- End Gender -->

					<!-- Trips per Day -->
					<div class="row data-row">
						<div id="data3" class="col-sm-12 col-md-12 col-lg-12 data-cell">
							<h4 style="text-align: center;">Number of Bikes Out in Day of Year</h4>
							<!--SCRIPT TO GENERATE GRAPHS-->
							<script>
								var margin = {top: 0, right: 0, bottom: 100, left: 40},
									barPadding = 1,
								    width2 = 2200,
								    height2 = 300 - margin.top - margin.bottom;

								var x = d3.scale.ordinal()
								    .rangeRoundBands([0, width2], .1);

								var y = d3.scale.linear()
								    .range([height2, 0]);

								var xAxis = d3.svg.axis()
								    .scale(x)
								    .orient("bottom");

								var yAxis = d3.svg.axis()
								    .scale(y)
								    .orient("left")
								    .ticks(10);

								var svg = d3.select('#data3').append("svg")
								.attr("viewBox", "0 0 960 500")
								.attr("preserveAspectRatio", "xMidYMid meet")
								.append("g")
								.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

								d3.tsv("Assets/CSV/day_of_year.tsv", type, function(error, data) {
									x.domain(data.map(function(d) { return d.date; }));
									y.domain([0, d3.max(data, function(d) { return d.numTrips })]);

								  svg.append("g")
								    	.attr("class", "y axis")
								    	.call(yAxis)
								    .append("text")
								    	.attr("transform", "rotate(-90)")
								    	.attr("y", 6)
								    	.attr("dy", ".71em")
								    	.style("text-anchor", "end")
								    	.text("NumTrips");

								  svg.append("g")
									    .attr("class", "x axis")
									    .attr("transform", "translate(0," + height2 + ")")
									    .call(xAxis)
									    .selectAll("text")  
									    .style("text-anchor", "end")
									    .attr("dx", "-.8em")
									    .attr("dy", ".15em")
									    .attr("transform", function(d) {
									        return "rotate(-65)" 
									    });

								  svg.selectAll(".bar")
								    	.data(data)
								    .enter().append("rect")
								    	.attr("class", "bar")
								     	.attr("x", function(d) { 
								     		var date = x(d.date)
								     		return date; })
								    	.attr("width", x.rangeBand())
								    	.attr("y", function(d) { return y(d.numTrips); })
								    	.attr("height", function(d) { return height2 - y(d.numTrips); });

								});

								function type(d) {
									d.numTrips = +d.numTrips;
									return d;
								}
							</script>

							<!-- Toggle script -->
							<script>
								$( "#b3" ).click(function() {
              						$( "#data3" ).toggle( "blind", 1000 );
            					});
							</script>
						</div><!--End data3 -->
					</div><!-- End data-row --><!-- End Trips per Day -->

				</div> <!-- End Right Side -->

			</div><!-- End Main Row -->
		</div><!-- End Main Body -->

		<!-- Master Toggle Script -->
		<script>
			$( "#b0" ).click(function() {
				$( "#data1, #data2, #data3" ).toggle( "blind", 1000 );
			});
		</script>
					
		<footer>
		</footer>
	</body>
</html>