<!DOCTYPE HTML>
<html>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script type="leaflet-tilelayer-geojson-master/TileLayer.GeoJSON.js"></script>
	<head>
		<title>Bike Race</title>
		<script src="./community_areas.geojson"></script>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<style type="text/css">
			body { margin: 0; padding: 0; }
			#map { position: absolute; top: 0; bottom: 0; width: 100%; }
		</style>
	</head>
	<body>
		<div id="map"><!--div to hold map-->
			<script>
				//mapbox street tiles with proper attribution and max zoom level.
				//max zoom set to 18 because it's the greatest zoom level where everything shows
				var street_map = L.tileLayer('http://{s}.tiles.mapbox.com/v3/nizobe.jn4og4o6/{z}/{x}/{y}.png', {
				    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
				    maxZoom: 18
				});//.addTo(map);

				//satellite imagery tile layer
				var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
					attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
				});//end satellite imagery tile layer

				//street and road labels overlay
				var Hydda_RoadsAndLabels = L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png', {
			    	minZoom: 0,
			    	maxZoom: 18,
			    	attribution: 'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
				});//end street and road labels overlay

				//geoJSON layer to hold community areas
				//var communityLayer = L.geoJson();
				var communities = new L.LayerGroup();
				L.geoJson(community_areas).addTo(communities);

				//leaflet layerGroup to hold divvy station markers
				var stations = L.layerGroup();

				//loop through .csv and add divvy stations to the statiosn layerGroup
				d3.csv("Divvy_Bicycle_Stations.csv", function(station_list) {
					for(var i = 0; i < station_list.length; i++)
					{
						var station_name = station_list[i].StationName;
						var station_lat = station_list[i].Latitude;
						var station_lon = station_list[i].Longitude;

						//marker = new L.marker([station_lat, station_lon]).bindPopup(station_name).openPopup().addTo()
						stations.addLayer(L.marker([station_lat, station_lon]).bindPopup(station_name).openPopup());
					}//end for loop through .csv file of divvy station locations
				});//end D3 import of divvy station .csv file

				/*
				var community_areas = new L.tileLayer.GeoJSON("community_areas.json");
				community_areas.setGeoJSONOptions({
				        /* style of GeoJSON feature /
				        style: {
				            "color": "#1B1",
				            "fillColor": "#1B1",
				            "weight": 0.7,
				            "opacity": 0.3,
				            "fillOpacity": 0.1
				        },
				        /* style of GeoJSON feature when hovered /
				        hoverStyle: {
				            "fillOpacity": 0.4
				        },
				        hoverOffset: new L.Point(30,-16)
				});
				*/

				//make a map with anchor lat,lon and zoom level
				var map = L.map('map', {
					center: [41.86968865729827, -87.64699459075926],
					zoom: 13,
					layers: [street_map, Esri_WorldImagery]
				});//.setView([41.86968865729827, -87.64699459075926], 13);

				/*mutually exclusive base map layers
				it seems that the last layer in the list is the default layer
				caveat: satellite (second option on control widget) is checked by default,
				even though the street maps layer is displaed by default */
				var baseMaps = {
					//"Street Map": street_map,
					"Satellite": Esri_WorldImagery,
					"Street Map": street_map
				};

				//toggle-able overlays
				var overlayMaps = {
					"Divvy Stations": stations,
					"Streets (for use with satellite map)": Hydda_RoadsAndLabels,
					"Community Areas": communities
					//"Community Areas": community_areas
				};

				//options for layer control widget
				var layerControlOptions = {
					position: 'topleft',
				}

				//adds layer toggle control to the map in top right
				L.control.layers(baseMaps, overlayMaps, layerControlOptions).addTo(map);
				//adds a scale meter to map; defaults to bottom left
				L.control.scale().addTo(map);

				/*
				//style for JSON overlay of community areas
				var style = {
					"clickable": true,
					"color": "#00D",
					"fillColor": "#00D",
					"weight": 1.0,
					"opacity": 0.3,
					"fillOpacity": 0.2
				};
				var hoverStyle = {
					"fillOpacity": 0.5
				}
				*/
				
				/*
				var communityAreaLayer = new L.tileLayer.GeoJSON("community_areas.json"), {
					clipTiles: true,
					unique: function (feature) {
						return feature.id;
					}, {
						style: style,
						onEachFeature: function (feature, layer) {
							if (feature.properties) {
								var popupString = '<div class="popup">';
							}
						}
					}
				};//end generation of community areas layer from .json
				*/
			</script>
		</div>
	</body>
</html>